!function(){"use strict";var a=function(a){var b=this;this.url=m.prop(a.url),this.plugins=m.prop(a.plugins),this.slug=m.prop(a.slug||Object.keys(a.plugins)[0]),this.n=m.prop(a.n||10),this.plugin_name=function(){for(var a=Object.keys(b.plugins()),c=0;c<a.length;c++)if(a[c]===b.slug())return b.plugins()[a[c]];return"Unknown"}},b={};b.vm=function(){var b={};return b.config=new a(wpp.config),b.init=function(){b.running=m.prop(!1),b.results=m.prop([]),b.finished=m.prop(!1),b.percentageDifference=m.prop(0),b.sums=m.prop({no_plugins:0,only_slug:0,all_but_slug:0,all_plugins:0})},b}(),b.addResult=function(a){b.vm.results().push(a);var c=b.vm.sums();Object.keys(a).forEach(function(b){c[b]+=a[b]});var d=(c.only_slug/c.no_plugins+c.all_plugins/c.all_but_slug)/2*100-100;b.vm.percentageDifference(d>0?d:0),m.redraw()},b.getResult=function(){if(b.vm.finished(b.vm.results().length>=b.vm.config.n()),b.vm.running()&&!b.vm.finished()){var a={method:"GET",url:wpp.ajaxurl,data:{action:"plugin_profiler",url:b.vm.config.url(),slug:b.vm.config.slug()}};m.request(a).then(function(a){b.addResult(a),b.getResult()})}},b.toggle=function(){b.vm.running()?b.stop():b.start(),m.redraw()},b.start=function(){b.vm.running(!0),b.getResult()},b.stop=function(){b.vm.running(!1)},b.reset=function(){b.vm.init()},b.updateChart=function(a,c,d){var e=b.vm,f=e.sums(),g=e.results().length,h=Object.keys(f).map(function(a){return(f[a]/g).toPrecision(4)});if(c){for(var i=0;i<d.chart.datasets[0].bars.length;i++)d.chart.datasets[0].bars[i].value=h[i];d.chart.update()}else{var j={labels:["No plugins","Only "+e.config.plugin_name(),"All but "+e.config.plugin_name(),"All plugins"],datasets:[{label:"Load times",strokeColor:"rgba(6, 211, 92,1)",fillColor:"rgba(6, 211, 92,1)",data:h}]},k={};d.chart=new Chart(a.getContext("2d")).Bar(j,k)}},b.controller=function(){b.vm.init()},b.view=function(){var a=b.vm;return b.vm.running()||0!==a.results().length?m("div.results",[m("p",[a.finished()?"":m("input",{type:"button","class":"button",onclick:b.toggle,value:a.running()?"Stop":"Continue"})," ",a.running()&&!a.finished()?"":m("input",{type:"button","class":"button button-danger",onclick:b.reset,value:"Reset"})]),m("p",[m("strong",a.finished()?"Done!":"Running... "+a.results().length+"/"+a.config.n())]),m("p",m.trust("On average, "+a.config.plugin_name()+" added <strong>"+a.percentageDifference().toPrecision(3)+"%</strong> to each request.")),m("canvas",{width:600,height:400,config:b.updateChart})]):[m("table.form-table",[m("tr",[m("th","Select the plugin to profile."),m("td",[m("select",{onchange:m.withAttr("value",b.vm.config.slug)},Object.keys(b.vm.config.plugins()).map(function(c){return m("option",{value:c,selected:a.config.slug()==c},b.vm.config.plugins()[c])}))])]),m("tr",[m("th","Enter the URL to profile"),m("td",[m("input",{type:"text","class":"regular-text",value:b.vm.config.url(),onchange:m.withAttr("value",b.vm.config.url)})])]),m("tr",[m("th","Number of requests"),m("td",[m("input",{type:"number",min:0,step:1,value:b.vm.config.n(),onchange:m.withAttr("value",b.vm.config.n)})])])]),m("p",[m("input",{type:"submit","class":"button button-primary",value:"Run Profile",onclick:b.start})])]},m.module(document.getElementById("profiler-mount"),b)}();